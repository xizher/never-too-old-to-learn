(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{205:function(t,s,a){"use strict";a.r(s);var n=a(6),r=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"数据库备份与还原的流程整理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据库备份与还原的流程整理"}},[t._v("#")]),t._v(" 数据库备份与还原的流程整理")]),t._v(" "),a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#mongodb"}},[t._v("MongoDB")]),a("ul",[a("li",[a("a",{attrs:{href:"#备份"}},[t._v("备份")])]),a("li",[a("a",{attrs:{href:"#还原"}},[t._v("还原")])])])]),a("li",[a("a",{attrs:{href:"#postgresql"}},[t._v("PostgreSQL")]),a("ul",[a("li",[a("a",{attrs:{href:"#备份"}},[t._v("备份")])]),a("li",[a("a",{attrs:{href:"#还原"}},[t._v("还原")])]),a("li",[a("a",{attrs:{href:"#删除数据库时目标数据库被锁的解决方案"}},[t._v("删除数据库时目标数据库被锁的解决方案")])])])]),a("li",[a("a",{attrs:{href:"#附录"}},[t._v("附录")]),a("ul",[a("li",[a("a",{attrs:{href:"#pg-dump-help"}},[t._v("pg_dump --help")])])])])])]),a("p"),t._v(" "),a("h2",{attrs:{id:"mongodb"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mongodb"}},[t._v("#")]),t._v(" MongoDB")]),t._v(" "),a("h3",{attrs:{id:"备份"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#备份"}},[t._v("#")]),t._v(" 备份")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("mongodump")])])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("mongodump -h 【host:post】 -d 【数据库名】 -u 【用户名】 -p 【密码】 -o 【备份路径】\n")])])]),a("table",[a("thead",[a("tr",[a("th",[a("strong",[t._v("参数")])]),t._v(" "),a("th",[a("strong",[t._v("参数说明")])])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("strong",[t._v("-h")])]),t._v(" "),a("td",[t._v("指明数据库宿主机的IP")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("-u")])]),t._v(" "),a("td",[t._v("指明数据库的用户名")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("-p")])]),t._v(" "),a("td",[t._v("指明数据库的密码")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("-d")])]),t._v(" "),a("td",[t._v("指明数据库的名字")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("-c")])]),t._v(" "),a("td",[t._v("指明collection的名字")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("-o")])]),t._v(" "),a("td",[t._v("指明到要导出的文件名")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("-q")])]),t._v(" "),a("td",[t._v("指明导出数据的过滤条件")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("--gzip")])]),t._v(" "),a("td",[t._v("备份时压缩")])])])]),t._v(" "),a("h3",{attrs:{id:"还原"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#还原"}},[t._v("#")]),t._v(" 还原")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("mongorestore")])])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("mongorestore -h 【host:post】 -u 【用户名】 -p 【密码】 -d 【目标数据库】 【数据库备份文件路径】\n")])])]),a("table",[a("thead",[a("tr",[a("th",[a("strong",[t._v("参数")])]),t._v(" "),a("th",[a("strong",[t._v("参数说明")])])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("strong",[t._v("-h")])]),t._v(" "),a("td",[t._v("指明数据库宿主机的IP")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("-u")])]),t._v(" "),a("td",[t._v("指明数据库的用户名")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("-p")])]),t._v(" "),a("td",[t._v("指明数据库的密码")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("-d")])]),t._v(" "),a("td",[t._v("指明数据库的名字")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("-c")])]),t._v(" "),a("td",[t._v("指明collection的名字")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("-o")])]),t._v(" "),a("td",[t._v("指明到要导出的文件名")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("-q")])]),t._v(" "),a("td",[t._v("指明导出数据的过滤条件")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("--authenticationDatabase")])]),t._v(" "),a("td",[t._v("验证数据的名称")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("--gzip")])]),t._v(" "),a("td",[t._v("备份时压缩")])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("--drop")])]),t._v(" "),a("td",[t._v("恢复的时候把之前的集合drop掉")])])])]),t._v(" "),a("h2",{attrs:{id:"postgresql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#postgresql"}},[t._v("#")]),t._v(" PostgreSQL")]),t._v(" "),a("h3",{attrs:{id:"备份-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#备份-2"}},[t._v("#")]),t._v(" 备份")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("pg_dump")])])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("pg_dump -h 【host】 -U 【用户名】 【数据库】 > 【备份文件路径】\npg_dump -h 【host】 -p 【端口】 -U 【用户名】 -d 【数据库】 -f 【备份文件路径】\n")])])]),a("p",[t._v("备份文件的后缀是**.bak**")]),t._v(" "),a("h3",{attrs:{id:"还原-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#还原-2"}},[t._v("#")]),t._v(" 还原")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("psql")])])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("psql -h 【host】 -U 【用户名】 -d 【目标数据库】 < 【备份文件路径】\n")])])]),a("h3",{attrs:{id:"删除数据库时目标数据库被锁的解决方案"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除数据库时目标数据库被锁的解决方案"}},[t._v("#")]),t._v(" 删除数据库时目标数据库被锁的解决方案")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" pg_terminate_backend"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pg_stat_activity"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" pg_stat_activity "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" datname "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'【被锁的数据库】'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" pid"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<>")]),t._v("pg_backend_pid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("drop")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("database")]),t._v(" 【被锁的数据库】"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h2",{attrs:{id:"附录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#附录"}},[t._v("#")]),t._v(" 附录")]),t._v(" "),a("h3",{attrs:{id:"pg-dump-help"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pg-dump-help"}},[t._v("#")]),t._v(" pg_dump --help")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("pg_dump 把一个数据库转储为纯文本文件或者是其它格式.\n\n用法:\n  pg_dump "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("选项"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(". "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("数据库名字"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n一般选项:\n  -f, --file"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("FILENAME          输出文件或目录名\n  -F, --format"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("c"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("d"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("t"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("p         输出文件格式 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("定制, 目录, "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("tar")]),t._v("\n                               明文 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("默认值"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("))")]),t._v("\n  -j, --jobs"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("NUM               执行多个并行任务进行备份转储工作\n  -v, --verbose                详细模式\n  -V, --version                输出版本信息，然后退出\n  -Z, --compress"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("-9           被压缩格式的压缩级别\n  --lock-wait-timeout"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("TIMEOUT  在等待表锁超时后操作失败\n  --no-sync                    不用等待变化安全写入磁盘\n  -?, --help                   显示此帮助, 然后退出\n\n控制输出内容选项:\n  -a, --data-only              只转储数据,不包括模式\n  -b, --blobs                  在转储中包括大对象\n  -B, --no-blobs               排除转储中的大型对象\n  -c, --clean                  在重新创建之前，先清除（删除）数据库对象\n  -C, --create                 在转储中包括命令,以便创建数据库\n  -E, --encoding"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ENCODING      转储以ENCODING形式编码的数据\n  -n, --schema"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("PATTERN         dump the specified schema"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" only\n  -N, --exclude-schema"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("PATTERN "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v(" NOT dump the specified schema"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  -O, --no-owner               在明文格式中, 忽略恢复对象所属者\n  -s, --schema-only            只转储模式, 不包括数据\n  -S, --superuser"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("NAME         在明文格式中使用指定的超级用户名\n  -t, --table"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("PATTERN          dump the specified table"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" only\n  -T, --exclude-table"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("PATTERN  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v(" NOT dump the specified table"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  -x, --no-privileges          不要转储权限 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("grant/revoke"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  --binary-upgrade             只能由升级工具使用\n  --column-inserts             以带有列名的INSERT命令形式转储数据\n  --disable-dollar-quoting     取消美元 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("符号"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" 引号, 使用 SQL 标准引号\n  --disable-triggers           在只恢复数据的过程中禁用触发器\n  --enable-row-security        启用行安全性（只转储用户能够访问的内容）\n  --exclude-table-data"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("PATTERN "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v(" NOT dump data "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" the specified table"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  --extra-float-digits"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("NUM     覆盖extra_float_digits的默认设置\n  --if-exists                  当删除对象时使用IF EXISTS\n  --inserts                    以INSERT命令，而不是COPY命令的形式转储数据\n  --load-via-partition-root    通过根表加载分区\n  --no-comments                不转储注释\n  --no-publications            不转储发布\n  --no-security-labels         不转储安全标签的分配\n  --no-subscriptions           不转储订阅\n  --no-synchronized-snapshots  在并行工作集中不使用同步快照\n  --no-tablespaces             不转储表空间分配信息\n  --no-unlogged-table-data     不转储没有日志的表数据\n  --on-conflict-do-nothing     将ON CONFLICT DO NOTHING添加到INSERT命令\n  --quote-all-identifiers      所有标识符加引号，即使不是关键字\n  --rows-per-insert"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("NROWS      每个插入的行数；意味着--inserts\n  --section"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("SECTION            备份命名的节 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("数据前, 数据, 及 数据后"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  --serializable-deferrable    等到备份可以无异常运行\n  --snapshot"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("SNAPSHOT          为转储使用给定的快照\n  --strict-names               要求每个表和"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("或"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("schema包括模式以匹配至少一个实体\n  --use-set-session-authorization\n                               使用 "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("SESSION")]),t._v(" AUTHORIZATION 命令代替\n                               ALTER OWNER 命令来设置所有权\n\n联接选项:\n  -d, --dbname"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("DBNAME      对数据库 DBNAME备份\n  -h, --host"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("主机名        数据库服务器的主机名或套接字目录\n  -p, --port"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("端口号        数据库服务器的端口号\n  -U, --username"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("名字      以指定的数据库用户联接\n  -w, --no-password        永远不提示输入口令\n  -W, --password           强制口令提示 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("自动"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  --role"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ROLENAME          在转储前运行SET ROLE\n\n如果没有提供数据库名字, 那么使用 PGDATABASE 环境变量\n的数值.\n\n报告错误至 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("pgsql-bugs@lists.postgresql.org"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(".\n")])])])])}),[],!1,null,null,null);s.default=r.exports}}]);