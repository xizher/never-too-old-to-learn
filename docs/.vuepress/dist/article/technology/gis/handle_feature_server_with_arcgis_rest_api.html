<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ArcGIS REST API操作要素服务 | 哲士</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="地理信息人">
    
    <link rel="preload" href="/assets/css/0.styles.992cb7aa.css" as="style"><link rel="preload" href="/assets/js/app.4322f863.js" as="script"><link rel="preload" href="/assets/js/2.6f24bad2.js" as="script"><link rel="preload" href="/assets/js/21.685515d9.js" as="script"><link rel="prefetch" href="/assets/js/10.4ae206fc.js"><link rel="prefetch" href="/assets/js/11.c238a9c6.js"><link rel="prefetch" href="/assets/js/12.df65c0c2.js"><link rel="prefetch" href="/assets/js/13.5fc3a3e4.js"><link rel="prefetch" href="/assets/js/14.126dce95.js"><link rel="prefetch" href="/assets/js/15.954b4b48.js"><link rel="prefetch" href="/assets/js/16.7358c494.js"><link rel="prefetch" href="/assets/js/17.9b3d42bf.js"><link rel="prefetch" href="/assets/js/18.68029a34.js"><link rel="prefetch" href="/assets/js/19.118a8eb9.js"><link rel="prefetch" href="/assets/js/20.8dc11ae6.js"><link rel="prefetch" href="/assets/js/22.315f9a48.js"><link rel="prefetch" href="/assets/js/23.f1f30101.js"><link rel="prefetch" href="/assets/js/24.4cac6b6f.js"><link rel="prefetch" href="/assets/js/25.e72264b4.js"><link rel="prefetch" href="/assets/js/26.f9c077c0.js"><link rel="prefetch" href="/assets/js/27.4582a97f.js"><link rel="prefetch" href="/assets/js/28.cca63c17.js"><link rel="prefetch" href="/assets/js/29.ebc370d8.js"><link rel="prefetch" href="/assets/js/3.4275f965.js"><link rel="prefetch" href="/assets/js/30.24cc0f69.js"><link rel="prefetch" href="/assets/js/31.ea032f96.js"><link rel="prefetch" href="/assets/js/32.04bc6f3d.js"><link rel="prefetch" href="/assets/js/33.84daef1f.js"><link rel="prefetch" href="/assets/js/34.40fdcc9b.js"><link rel="prefetch" href="/assets/js/35.ae36a844.js"><link rel="prefetch" href="/assets/js/36.9976dce7.js"><link rel="prefetch" href="/assets/js/37.7ecf29d1.js"><link rel="prefetch" href="/assets/js/4.e0652429.js"><link rel="prefetch" href="/assets/js/5.62a68b3b.js"><link rel="prefetch" href="/assets/js/6.2cc0afe6.js"><link rel="prefetch" href="/assets/js/7.42839bd3.js"><link rel="prefetch" href="/assets/js/8.895adc79.js"><link rel="prefetch" href="/assets/js/9.71ac8dd8.js">
    <link rel="stylesheet" href="/assets/css/0.styles.992cb7aa.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">哲士</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/article/technology/" class="nav-link router-link-active">
  技术
</a></div><div class="nav-item"><a href="/article/daily/" class="nav-link">
  日志
</a></div><div class="nav-item"><a href="/download.html" class="nav-link">
  资源
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  关于
</a></div><div class="nav-item"><a href="https://www.github.com/xizher" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/article/technology/" class="nav-link router-link-active">
  技术
</a></div><div class="nav-item"><a href="/article/daily/" class="nav-link">
  日志
</a></div><div class="nav-item"><a href="/download.html" class="nav-link">
  资源
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  关于
</a></div><div class="nav-item"><a href="https://www.github.com/xizher" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>GIS</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/article/technology/gis/begin_to_google_earth_engine.html" class="sidebar-link">GoogleEarthEngine学习笔记</a></li><li><a href="/article/technology/gis/handle_feature_server_with_arcgis_rest_api.html" aria-current="page" class="active sidebar-link">ArcGIS REST API操作要素服务</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/article/technology/gis/handle_feature_server_with_arcgis_rest_api.html#一、前提" class="sidebar-link">一、前提</a></li><li class="sidebar-sub-header"><a href="/article/technology/gis/handle_feature_server_with_arcgis_rest_api.html#二、-实现" class="sidebar-link">二、 实现</a></li><li class="sidebar-sub-header"><a href="/article/technology/gis/handle_feature_server_with_arcgis_rest_api.html#四、-后记" class="sidebar-link">四、 后记</a></li></ul></li><li><a href="/article/technology/gis/local_deployment_arcgisjsapi_with_nginx_and_vue.html" class="sidebar-link">基于nginx的ArcGIS API for JS本地部署及在Vue框架下跨域调用的解决方案</a></li><li><a href="/article/technology/gis/raster_block_statistics_with_r.html" class="sidebar-link">R语言实现栅格块统计算法</a></li><li><a href="/article/technology/gis/something_know_with_vector_tiles_and_raster_tiles.html" class="sidebar-link">矢量切片与栅格切片的认知</a></li><li><a href="/article/technology/gis/use_atmospheric_correction_method_to_surface_temperature_with_landset8.html" class="sidebar-link">大气校正法反演Landsat8影像地表温度</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>VUE</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工程化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据库</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>服务器</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="arcgis-rest-api操作要素服务"><a href="#arcgis-rest-api操作要素服务" class="header-anchor">#</a> ArcGIS REST API操作要素服务</h1> <h2 id="一、前提"><a href="#一、前提" class="header-anchor">#</a> 一、前提</h2> <ul><li>使用<code>axios</code>库进行Ajax请求；</li> <li>使用ES6 class语法对要素服务的操作进行封装；</li></ul> <h2 id="二、-实现"><a href="#二、-实现" class="header-anchor">#</a> 二、 实现</h2> <h3 id="_1-类定义"><a href="#_1-类定义" class="header-anchor">#</a> 1. 类定义</h3> <p>要素服务操作类定义为<code>FeatureHandle</code>，<code>contstructor</code>为类的构造函数。其中，featureUrl参数为要素服务的地址，为http://xxxxx/FeatureServer/0的形式，options为一些配置参数（下面会讲到），默认为空对象。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> FeatureHandle <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token parameter">featureUrl<span class="token punctuation">,</span> options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_2-类属性"><a href="#_2-类属性" class="header-anchor">#</a> 2.  类属性</h3> <p>构造函数中定义了两个<u>私有变量</u>，分别是记录要素服务地址的<code>_featureUrl</code>和记录配置信息的<code>_options</code>，其中，<code>_options.f</code>为请求后响应数据的格式，默认为<code>json</code>；<code>_options.gdbVersion</code>为操作要素服务的数据库版本，默认为空，及对当前版本进行要素操作；<code>_options.rollbackOnFailure</code>为是否仅在所有提交的编辑成功后才应用编辑，默认为<code>true</code>。<code>Object.keys...</code>语句起覆盖配置参数默认项作用。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token parameter">featureUrl<span class="token punctuation">,</span> options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> _featureUrl <span class="token operator">=</span> featureUrl<span class="token punctuation">;</span>
    <span class="token keyword">const</span> _options <span class="token operator">=</span> <span class="token punctuation">{</span>
        f<span class="token operator">:</span> <span class="token string">'json'</span><span class="token punctuation">,</span>
        gdbVersion<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        rollbackOnFailure<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
    Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> _options<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> options<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="三、-编写要素操作方法"><a href="#三、-编写要素操作方法" class="header-anchor">#</a> 三、 编写要素操作方法</h3> <h4 id="_3-1-集成私有方法"><a href="#_3-1-集成私有方法" class="header-anchor">#</a> 3.1 集成私有方法</h4> <ul><li><code>_axiosGet</code>集成<code>axios</code>的<code>get</code>方法</li> <li><code>_axiosPost</code>集成<code>axios</code>的<code>post</code>方法</li> <li><code>_stringfy</code>负责格式化<code>JSON</code>参数为<u>key=val&amp;key=val</u>的形式</li> <li><code>_checkObjectID</code>检查<code>features</code>对象中的属性时候函数<code>ObjectID</code>字段属性</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">_axiosGet</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        	params<span class="token operator">:</span> options
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            	<span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'网络异常，请求失败'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'网络异常，请求失败'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">_axiosPost</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token function">_stringfy</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> headers<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/x-www-form-urlencoded'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'网络异常，请求失败'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'网络异常，请求失败'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">_stringfy</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> val <span class="token operator">=</span> options<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> options<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            val <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>options<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            str <span class="token operator">=</span> str <span class="token operator">+</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>val<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    str <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> str<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> str<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">_checkObjectID</span><span class="token punctuation">(</span><span class="token parameter">features</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> features<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> feat <span class="token operator">=</span> features<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>feat<span class="token punctuation">.</span>attributes <span class="token operator">&amp;&amp;</span> feat<span class="token punctuation">.</span>attributes<span class="token punctuation">.</span><span class="token constant">OBJECTID</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_3-2-要素查询"><a href="#_3-2-要素查询" class="header-anchor">#</a> 3.2 要素查询</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">query</span> <span class="token operator">=</span> <span class="token parameter">opts</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span>
            where <span class="token operator">=</span> <span class="token string">'1=1'</span><span class="token punctuation">,</span>
            outFields <span class="token operator">=</span> <span class="token string">'*'</span><span class="token punctuation">,</span>
            returnGeometry <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            geometry <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
            geometryType <span class="token operator">=</span> <span class="token string">'esriGeometryEnvelope'</span><span class="token punctuation">,</span>
            inSR <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
            spatialRel <span class="token operator">=</span> <span class="token string">'esriSpatialRelIntersects'</span><span class="token punctuation">,</span>
            outSR <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
            returnCountOnly <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span> <span class="token operator">=</span> opts <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token function">_axiosGet</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>_featureUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/query</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            where<span class="token punctuation">,</span> outFields<span class="token punctuation">,</span> returnGeometry<span class="token punctuation">,</span> geometry<span class="token punctuation">,</span> geometryType<span class="token punctuation">,</span> inSR<span class="token punctuation">,</span> spatialRel<span class="token punctuation">,</span> outSR<span class="token punctuation">,</span> returnCountOnly<span class="token punctuation">,</span>
            f<span class="token operator">:</span> _options<span class="token punctuation">.</span>f
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_3-3-要素添加"><a href="#_3-3-要素添加" class="header-anchor">#</a> 3.3 要素添加</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token parameter">features</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> features <span class="token operator">!=</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'添加要素格式有误'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>js<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>features<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                features <span class="token operator">=</span> <span class="token punctuation">[</span>features<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token function">_axiosPost</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>_featureUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/addFeatures</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                features<span class="token punctuation">,</span> <span class="token operator">...</span>_options
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_3-4-要素删除"><a href="#_3-4-要素删除" class="header-anchor">#</a> 3.4 要素删除</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">delete</span> <span class="token operator">=</span> <span class="token parameter">opts</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span>
            objectIds<span class="token punctuation">,</span>
            where<span class="token punctuation">,</span>
            geometry<span class="token punctuation">,</span>
            geometryType <span class="token operator">=</span> <span class="token string">'esriGeometryEnvelope'</span><span class="token punctuation">,</span>
            inSR <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
            spatialRel <span class="token operator">=</span> <span class="token string">'esriSpatialRelIntersects'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span> <span class="token operator">=</span> opts <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token function">_axiosPost</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>_featureUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/deleteFeatures</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            objectIds<span class="token punctuation">,</span> where<span class="token punctuation">,</span> geometry<span class="token punctuation">,</span> geometryType<span class="token punctuation">,</span> inSR<span class="token punctuation">,</span> spatialRel<span class="token punctuation">,</span> <span class="token operator">...</span>_options
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_3-5-要素更新"><a href="#_3-5-要素更新" class="header-anchor">#</a> 3.5 要素更新</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">update</span> <span class="token operator">=</span> <span class="token parameter">features</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> features <span class="token operator">!=</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'添加要素格式有误'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>js<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>features<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                features <span class="token operator">=</span> <span class="token punctuation">[</span>features<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">_checkObjectID</span><span class="token punctuation">(</span>features<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'存在未指定要更新的要素'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token function">_axiosPost</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>_featureUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/updateFeatures</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                    features<span class="token punctuation">,</span> <span class="token operator">...</span>_options
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="四、-后记"><a href="#四、-后记" class="header-anchor">#</a> 四、 后记</h2> <h3 id="参考"><a href="#参考" class="header-anchor">#</a> 参考</h3> <p><a href="https://blog.csdn.net/wuwenjinwuwenjin/article/details/37722661" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/wuwenjinwuwenjin/article/details/37722661<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://gis.stackexchange.com/questions/34735/invalid-parameters-on-arcgis-rest-api-used-from-silverlight" target="_blank" rel="noopener noreferrer">https://gis.stackexchange.com/questions/34735/invalid-parameters-on-arcgis-rest-api-used-from-silverlight<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="完整代码"><a href="#完整代码" class="header-anchor">#</a> 完整代码</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">/**
 * @class FeatureHandle
 * @description 要素服务操作类
 * @param {String} featureUrl 要素服务地址
 * @returns {FeatureHandle} 要素服务操作类
 * @requires {@link namespace}
 * @requires {@link js.ext}
 * @example
 *  const featureHandle = new FeatureHandle('http://xxx/FeatureServer/0');
    
    // 要素查询
    featureHandle.query().then(res =&gt; {
        // 请求成功后执行
    }).catch(err =&gt; {
        // 请求失败执行
    });

    // 要素添加
    featureHandle.add( {
        'geometry': { x: 715563.5969000032, y: 2541615.1215033004 },
        'attributes': { 'XMLXMC': '测试添加' }
    }).then(res =&gt; {
        // 请求成功后执行
    }).catch(err =&gt; {
        // 请求失败执行
    });

    // 要素删除
    featureHandle.delete({
        objectIds: 128
    }).then(res =&gt; {
        // 请求成功后执行
    }).catch(err =&gt; {
        // 请求失败执行
    });

    // 要素更新
    featureHandle.update({
        'attributes': { OBJECTID: 321, SBDW: '测试更新' }
    }).then(res =&gt; {
        // 请求成功后执行
    }).catch(err =&gt; {
        // 请求失败执行
    });

 */</span>
<span class="token constant">FSSG</span><span class="token punctuation">.</span>FeatureHandle <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token punctuation">{</span>
    <span class="token comment">//#region 构造函数</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">featureUrl<span class="token punctuation">,</span> options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">/**
         * 要素服务地址
         * @type {String}
         * @memberof FeatureHandle
         * @instance
         * @name _featureUrl
         */</span>
        <span class="token keyword">const</span> _featureUrl <span class="token operator">=</span> featureUrl<span class="token punctuation">;</span>

        <span class="token comment">/**
         * 参数初始化设置
         * @type {object}
         * @memberof FeatureHandle
         * @instance
         */</span>
        <span class="token keyword">const</span> _options <span class="token operator">=</span> <span class="token punctuation">{</span>
            f<span class="token operator">:</span> <span class="token string">'json'</span><span class="token punctuation">,</span> <span class="token comment">// 响应格式，默认为json</span>
            gdbVersion<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment">// 要查询的地理数据库版本，如果未指定gdbVersion，则该查询将应用于已发布地图的版本</span>
            rollbackOnFailure<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// ，用于指定是否仅在所有提交的编辑成功后才应用编辑，默认为true</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token comment">// 获取设置的参数</span>
        Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> _options<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> options<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//#region 在构造函数中扩展方法，以便访问私有数据和方法</span>
        <span class="token comment">/**
         * 要素查询
         * @param {Object} opts 查询参数
         * @param {String} opts.where 过滤WHERE，默认为1=1，全部输出
         * @param {String} opts.outFields 插入输入字段，默认为*，全部输出
         * @param {Boolean} opts.returnGeometry 是否输出几何，默认为true
         */</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">query</span> <span class="token operator">=</span> <span class="token parameter">opts</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">const</span> <span class="token punctuation">{</span>
                    where <span class="token operator">=</span> <span class="token string">'1=1'</span><span class="token punctuation">,</span>
                    outFields <span class="token operator">=</span> <span class="token string">'*'</span><span class="token punctuation">,</span>
                    returnGeometry <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                    geometry <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
                    geometryType <span class="token operator">=</span> <span class="token string">'esriGeometryEnvelope'</span><span class="token punctuation">,</span>
                    inSR <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
                    spatialRel <span class="token operator">=</span> <span class="token string">'esriSpatialRelIntersects'</span><span class="token punctuation">,</span>
                    outSR <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
                    returnCountOnly <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span> <span class="token operator">=</span> opts <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
                <span class="token function">_axiosGet</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>_featureUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/query</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                    where<span class="token punctuation">,</span> outFields<span class="token punctuation">,</span> returnGeometry<span class="token punctuation">,</span> geometry<span class="token punctuation">,</span> geometryType<span class="token punctuation">,</span> inSR<span class="token punctuation">,</span> spatialRel<span class="token punctuation">,</span> outSR<span class="token punctuation">,</span> returnCountOnly<span class="token punctuation">,</span>
                    f<span class="token operator">:</span> _options<span class="token punctuation">.</span>f
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">/**
         * 要素添加
         * @param {Array|Object} features 添加的要素(s)
         * @return {Promise}
         */</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token parameter">features</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> features <span class="token operator">!=</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'添加要素格式有误'</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>js<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>features<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        features <span class="token operator">=</span> <span class="token punctuation">[</span>features<span class="token punctuation">]</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token function">_axiosPost</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>_featureUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/addFeatures</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                        features<span class="token punctuation">,</span> <span class="token operator">...</span>_options
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">/**
         * 要素删除
         * @param {Object} opts 删除参数
         * @return {Promise}
         */</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">delete</span> <span class="token operator">=</span> <span class="token parameter">opts</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">const</span> <span class="token punctuation">{</span>
                    objectIds<span class="token punctuation">,</span>
                    where<span class="token punctuation">,</span>
                    geometry<span class="token punctuation">,</span>
                    geometryType <span class="token operator">=</span> <span class="token string">'esriGeometryEnvelope'</span><span class="token punctuation">,</span>
                    inSR <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
                    spatialRel <span class="token operator">=</span> <span class="token string">'esriSpatialRelIntersects'</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span> <span class="token operator">=</span> opts <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
                <span class="token function">_axiosPost</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>_featureUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/deleteFeatures</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                    objectIds<span class="token punctuation">,</span> where<span class="token punctuation">,</span> geometry<span class="token punctuation">,</span> geometryType<span class="token punctuation">,</span> inSR<span class="token punctuation">,</span> spatialRel<span class="token punctuation">,</span> <span class="token operator">...</span>_options
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">/**
         * 要素更新
         * @param {Object|Array} features 更新的要素
         * @return {Promise}
         */</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">update</span> <span class="token operator">=</span> <span class="token parameter">features</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> features <span class="token operator">!=</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'添加要素格式有误'</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>js<span class="token punctuation">.</span>ext<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>features<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        features <span class="token operator">=</span> <span class="token punctuation">[</span>features<span class="token punctuation">]</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">_checkObjectID</span><span class="token punctuation">(</span>features<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'存在未指定要更新的要素'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                        <span class="token function">_axiosPost</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>_featureUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/updateFeatures</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                            features<span class="token punctuation">,</span> <span class="token operator">...</span>_options
                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">//#endregion</span>

        <span class="token comment">//#region 私有方法</span>
        <span class="token comment">/**
         * Ajax（Get）请求
         * @param {String} url 请求地址
         * @param {Object} options 请求参数
         * @return {Promise}
         */</span>
        <span class="token keyword">function</span> <span class="token function">_axiosGet</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span>
                    params<span class="token operator">:</span> options
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                        console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'网络异常，请求失败'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'网络异常，请求失败'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">/**
         * Ajax（Post）请求
         * @param {String} url 请求地址
         * @param {Object} options 请求参数
         * @return {Promise}
         */</span>
        <span class="token keyword">function</span> <span class="token function">_axiosPost</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token function">_stringfy</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> headers<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/x-www-form-urlencoded'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                        console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'网络异常，请求失败'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'网络异常，请求失败'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">/**
         * 请求数据格式化
         * @param {Object} options 请求参数
         * @return {String} 格式化参数
         */</span>
        <span class="token keyword">function</span> <span class="token function">_stringfy</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">let</span> val <span class="token operator">=</span> options<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> options<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    val <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>options<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    str <span class="token operator">=</span> str <span class="token operator">+</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>val<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            str <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> str<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> str<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">/**
         * 检查要素s是否含有OBJECTID属性值
         * @param {Array} features 要素s
         */</span>
        <span class="token keyword">function</span> <span class="token function">_checkObjectID</span><span class="token punctuation">(</span><span class="token parameter">features</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> features<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">const</span> feat <span class="token operator">=</span> features<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>feat<span class="token punctuation">.</span>attributes <span class="token operator">&amp;&amp;</span> feat<span class="token punctuation">.</span>attributes<span class="token punctuation">.</span><span class="token constant">OBJECTID</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//#endregion</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//#endregion</span>

<span class="token punctuation">}</span>

</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/article/technology/gis/begin_to_google_earth_engine.html" class="prev">
        GoogleEarthEngine学习笔记
      </a></span> <span class="next"><a href="/article/technology/gis/local_deployment_arcgisjsapi_with_nginx_and_vue.html">
        基于nginx的ArcGIS API for JS本地部署及在Vue框架下跨域调用的解决方案
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.4322f863.js" defer></script><script src="/assets/js/2.6f24bad2.js" defer></script><script src="/assets/js/21.685515d9.js" defer></script>
  </body>
</html>
